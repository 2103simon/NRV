<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2023.05.20 -->
        <title>nrv.nmod.myelinated - NeuRon Virtualizer (NRV) 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=e6660623a769aa55fea372102b9bf3151b292993" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f0f0f0;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #232629;
  --color-code-foreground: #cccccc;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #232629;
  --color-code-foreground: #cccccc;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../../index.html"><div class="brand">NeuRon Virtualizer (NRV) 1.0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../index.html">
  
  
  <span class="sidebar-brand-text">NeuRon Virtualizer (NRV) 1.0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../modules.html">nrv</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of nrv</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../../nrv.html">nrv package</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of nrv package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../nrv.backend.html">nrv.backend package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrv.fmod.html">nrv.fmod package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrv.nmod.html">nrv.nmod package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrv.optim.html">nrv.optim package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../nrv.utils.html">nrv.utils package</a></li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <h1>Source code for nrv.nmod.myelinated</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">NRV-myelinated</span>
<span class="sd">Authors: Florian Kolbl / Roland Giraud / Louis Regnacq / Thomas Couppey</span>
<span class="sd">(c) ETIS - University Cergy-Pontoise - CNRS</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">.axons</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">..backend.log_interface</span> <span class="kn">import</span> <span class="n">rise_error</span><span class="p">,</span> <span class="n">rise_warning</span><span class="p">,</span> <span class="n">pass_info</span>

<span class="n">MRG_fiberD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">,</span> <span class="mf">7.3</span><span class="p">,</span> <span class="mf">8.7</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">11.5</span><span class="p">,</span> <span class="mf">12.8</span><span class="p">,</span> <span class="mf">14.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">16.0</span><span class="p">])</span>
<span class="n">MRG_g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">0.565</span><span class="p">,</span> <span class="mf">0.585</span><span class="p">,</span> <span class="mf">0.605</span><span class="p">,</span> <span class="mf">0.630</span><span class="p">,</span> <span class="mf">0.661</span><span class="p">,</span> <span class="mf">0.690</span><span class="p">,</span> <span class="mf">0.700</span><span class="p">,</span> <span class="mf">0.719</span><span class="p">,</span> <span class="mf">0.739</span><span class="p">,</span> <span class="mf">0.767</span><span class="p">,</span> <span class="mf">0.791</span><span class="p">])</span>
<span class="n">MRG_axonD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">,</span> <span class="mf">6.9</span><span class="p">,</span> <span class="mf">8.1</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="mf">10.4</span><span class="p">,</span> <span class="mf">11.5</span><span class="p">,</span> <span class="mf">12.7</span><span class="p">])</span>
<span class="n">MRG_nodeD</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">4.7</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">])</span>
<span class="n">MRG_paraD1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="mf">3.7</span><span class="p">,</span> <span class="mf">4.2</span><span class="p">,</span> <span class="mf">4.7</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">])</span>
<span class="n">MRG_paraD2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">3.4</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">,</span> <span class="mf">6.9</span><span class="p">,</span> <span class="mf">8.1</span><span class="p">,</span> <span class="mf">9.2</span><span class="p">,</span> <span class="mf">10.4</span><span class="p">,</span> <span class="mf">11.5</span><span class="p">,</span> <span class="mf">12.7</span><span class="p">])</span>
<span class="n">MRG_deltax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">750</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1150</span><span class="p">,</span> <span class="mi">1250</span><span class="p">,</span> <span class="mi">1350</span><span class="p">,</span> <span class="mi">1400</span><span class="p">,</span> <span class="mi">1450</span><span class="p">,</span> <span class="mi">1500</span><span class="p">])</span>
<span class="n">MRG_paralength2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">60</span><span class="p">])</span>
<span class="n">MRG_nl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">150</span><span class="p">])</span>

<div class="viewcode-block" id="get_MRG_parameters"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.get_MRG_parameters">[docs]</a><span class="k">def</span> <span class="nf">get_MRG_parameters</span><span class="p">(</span><span class="n">diameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the MRG parameters</span>

<span class="sd">    Original parameters are listed and used if the input diameter is in the list,</span>
<span class="sd">    parameters are interpolated if the diameter is not in the original list.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    diameter    : float</span>
<span class="sd">        diameter of the unmylinated axon to implement, in um</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    g           : float</span>
<span class="sd">    axonD       : float</span>
<span class="sd">    nodeD       : float</span>
<span class="sd">    paraD1      : float</span>
<span class="sd">    paraD2      : float</span>
<span class="sd">    deltax      : float</span>
<span class="sd">    paralength2 : float</span>
<span class="sd">    nl          : float</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">diameter</span> <span class="ow">in</span> <span class="n">MRG_fiberD</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">MRG_fiberD</span> <span class="o">==</span> <span class="n">diameter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">MRG_g</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">axonD</span> <span class="o">=</span> <span class="n">MRG_axonD</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">nodeD</span> <span class="o">=</span> <span class="n">MRG_nodeD</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">paraD1</span> <span class="o">=</span> <span class="n">MRG_paraD1</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">paraD2</span> <span class="o">=</span> <span class="n">MRG_paraD2</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">deltax</span> <span class="o">=</span> <span class="n">MRG_deltax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">paralength2</span> <span class="o">=</span> <span class="n">MRG_paralength2</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="n">nl</span> <span class="o">=</span> <span class="n">MRG_nl</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># create fiting polynomyals</span>
        <span class="n">g_poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">MRG_fiberD</span><span class="p">,</span> <span class="n">MRG_g</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">axonD_poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">MRG_fiberD</span><span class="p">,</span> <span class="n">MRG_axonD</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">nodeD_poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">MRG_fiberD</span><span class="p">,</span> <span class="n">MRG_nodeD</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">paraD1_poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">MRG_fiberD</span><span class="p">,</span> <span class="n">MRG_paraD1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">paraD2_poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">MRG_fiberD</span><span class="p">,</span> <span class="n">MRG_paraD2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">deltax_poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">MRG_fiberD</span><span class="p">,</span> <span class="n">MRG_deltax</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">diameter</span> <span class="o">&lt;</span> <span class="mf">1.</span> <span class="ow">or</span> <span class="n">diameter</span> <span class="o">&gt;</span> <span class="mf">16.0</span><span class="p">:</span>
            <span class="c1"># outside of the MRG originla limit, take 1st order approx,</span>
            <span class="n">paralength2_poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">MRG_fiberD</span><span class="p">,</span> <span class="n">MRG_paralength2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># try to fit a bit better</span>
            <span class="n">paralength2_poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">MRG_fiberD</span><span class="p">,</span> <span class="n">MRG_paralength2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">nl_poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">MRG_fiberD</span><span class="p">,</span> <span class="n">MRG_nl</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="c1"># evaluate for the requested diameter</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">g_poly</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span>
        <span class="n">axonD</span> <span class="o">=</span> <span class="n">axonD_poly</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span>
        <span class="n">nodeD</span> <span class="o">=</span> <span class="n">nodeD_poly</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span>
        <span class="n">paraD1</span> <span class="o">=</span> <span class="n">paraD1_poly</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span>
        <span class="n">paraD2</span> <span class="o">=</span> <span class="n">paraD2_poly</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span>
        <span class="n">deltax</span> <span class="o">=</span> <span class="n">deltax_poly</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span>
        <span class="n">paralength2</span> <span class="o">=</span> <span class="n">paralength2_poly</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span>
        <span class="n">nl</span> <span class="o">=</span> <span class="n">nl_poly</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">axonD</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">nodeD</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">paraD1</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">paraD2</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">deltax</span><span class="p">),</span> \
        <span class="nb">float</span><span class="p">(</span><span class="n">paralength2</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">nl</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_length_from_nodes"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.get_length_from_nodes">[docs]</a><span class="k">def</span> <span class="nf">get_length_from_nodes</span><span class="p">(</span><span class="n">diameter</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to compute the length of a myelinated axon to get the correct number of Nodes of Ranvier</span>
<span class="sd">    For Myelinated models only (not compatible with A delta thin myelinated models)</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    diameter    : float</span>
<span class="sd">        diameter of the axon in um</span>
<span class="sd">    nodes       : int</span>
<span class="sd">        number of nodes in the axon</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    length      : float</span>
<span class="sd">        lenth of the axon with the correct number of nodes in um</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">diameter</span> <span class="ow">in</span> <span class="n">MRG_fiberD</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">MRG_fiberD</span> <span class="o">==</span> <span class="n">diameter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">deltax</span> <span class="o">=</span> <span class="n">MRG_deltax</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">deltax_poly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">MRG_fiberD</span><span class="p">,</span> <span class="n">MRG_deltax</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">deltax</span> <span class="o">=</span> <span class="n">deltax_poly</span><span class="p">(</span><span class="n">diameter</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">deltax</span><span class="o">*</span><span class="p">(</span><span class="n">nodes</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span></div>

<div class="viewcode-block" id="myelinated"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated">[docs]</a><span class="k">class</span> <span class="nc">myelinated</span><span class="p">(</span><span class="n">axon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Myelineated axon class. Automatic refinition of all neuron sections and properties. User-friendly object including model definition</span>
<span class="sd">    Inherit from axon class. see axon for further detail.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;MRG&#39;</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">node_shift</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nseg_per_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>\
        <span class="n">freq_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mesh_shape</span><span class="o">=</span><span class="s1">&#39;plateau_sigmoid&#39;</span><span class="p">,</span> <span class="n">alpha_max</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">d_lambda</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">rec</span><span class="o">=</span><span class="s1">&#39;nodes&#39;</span><span class="p">,</span>\
        <span class="n">v_init</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=-</span><span class="mi">40</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        initialisation of a myelinted axon</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        y               : float</span>
<span class="sd">            y coordinate for the axon, in um</span>
<span class="sd">        z               : float</span>
<span class="sd">            z coordinate for the axon, in um</span>
<span class="sd">        d               : float</span>
<span class="sd">            axon diameter, in um</span>
<span class="sd">        L               : float</span>
<span class="sd">            axon length along the x axins, in um</span>
<span class="sd">        model           : str</span>
<span class="sd">            choice of conductance double-cable based model, possibly:</span>
<span class="sd">                &#39;MRG&#39;           : see [1] for details</span>
<span class="sd">                &#39;Gaines_motor&#39;  : Gaines motor model, see [2]</span>
<span class="sd">                &#39;Gaines_sensory&#39;: Gaines sensory model, see [2]</span>
<span class="sd">        dt              : float</span>
<span class="sd">            computation step for simulations, in ms. By default equal to 1 us</span>
<span class="sd">        node_shift      : float</span>
<span class="sd">            shift of the first node of Ranvier to zeros, as a fraction of internode length (0&lt;= node_shift &lt; 1)</span>
<span class="sd">        Nseg_per_sec    : int</span>
<span class="sd">            Number of segment per section in the axon. If set to 0, the number of segment is automatically computed using d-lambda rule and following paramters. If set by user, please use odd numbers</span>
<span class="sd">        freq            : float</span>
<span class="sd">            Frequency used for the d-lmbda rule, corresponding to the maximum membrane current frequency, by default set to 100 Hz</span>
<span class="sd">        freq_min        : float</span>
<span class="sd">            Minimal frequency fot the d-lambda rule when using an irregular number of segment along the axon, if set to 0, all sections have the same frequency determined by the previous parameter</span>
<span class="sd">        mesh_shape      : str</span>
<span class="sd">            Shape of the frequencial distribution for the dlmabda rule along the axon, pick between:</span>
<span class="sd">                &#39;pyramidal&#39;         -&gt; min frequencies on both sides and linear increase up to the middle at the maximum frequency</span>
<span class="sd">                &#39;sigmoid&#39;           -&gt; same a befor with sigmoid increase instead of linear</span>
<span class="sd">                &#39;plateau&#39;           -&gt; sale as pyramidal except the max frequency is holded on a central plateau</span>
<span class="sd">                &#39;plateau_sigmoid&#39;   -&gt; same as previous with sigmoid increase</span>
<span class="sd">        alpha_max       : float</span>
<span class="sd">            Proportion of the axon set to the maximum frequency for plateau shapes, by default set to 0.3</span>
<span class="sd">        d_lambda        : float</span>
<span class="sd">            value of d-lambda for the dlambda rule</span>
<span class="sd">        rec             : str</span>
<span class="sd">            recording zones for the membrane potential, eiter:</span>
<span class="sd">                &#39;nodes&#39; -&gt; record only at the nodes of Ranvier</span>
<span class="sd">            or</span>
<span class="sd">                &#39;all&#39; -&gt; all computation points in nodes of Ranvier and over myelin</span>
<span class="sd">        v_init          : float</span>
<span class="sd">            Initial value of the membrane voltage in mV, set None to get an automatically model attributed value</span>
<span class="sd">        T               : gloat</span>
<span class="sd">            temperature in C, set None to get an automatically model attributed value</span>
<span class="sd">        ID              : int</span>
<span class="sd">            axon ID, by default set to 0,</span>
<span class="sd">        threshold       : float</span>
<span class="sd">            voltage threshold in mV for further spike detection in post-processing, by defautl set to -40mV, see post-processing library for further help</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        scientific sources for models:</span>
<span class="sd">        [1] McIntyre CC, Richardson AG, and Grill WM. Modeling the excitability of mammalian nerve fibers: influence of afterpotentials on the recovery cycle. Journal of Neurophysiology 87:995-1006, 2002.</span>
<span class="sd">        [2] Gaines, J. L., Finn, K. E., Slopsema, J. P., Heyboer, L. A.,  Polasek, K. H. (2018). A model of motor and sensory axon activation in the median nerve using surface electrical stimulation. Journal of computational neuroscience, 45(1), 29-43.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span> <span class="n">Nseg_per_sec</span><span class="o">=</span><span class="n">Nseg_per_sec</span><span class="p">,</span>\
            <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">,</span> <span class="n">freq_min</span><span class="o">=</span><span class="n">freq_min</span><span class="p">,</span> <span class="n">mesh_shape</span><span class="o">=</span><span class="n">mesh_shape</span><span class="p">,</span> <span class="n">alpha_max</span><span class="o">=</span><span class="n">alpha_max</span><span class="p">,</span> \
            <span class="n">d_lambda</span><span class="o">=</span><span class="n">d_lambda</span><span class="p">,</span> <span class="n">v_init</span><span class="o">=</span><span class="n">v_init</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="n">ID</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myelinated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thin</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec</span> <span class="o">=</span> <span class="n">rec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">=</span> <span class="n">node_shift</span>

        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">myelinated_models</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;MRG&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__compute_axon_parameters</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__compute_axon_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate axon from parameters set by user</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_init</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># model driven</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_sensory&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v_init</span> <span class="o">=</span> <span class="o">-</span><span class="mf">79.3565</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_motor&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v_init</span> <span class="o">=</span> <span class="o">-</span><span class="mf">85.9411</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">v_init</span> <span class="o">=</span> <span class="o">-</span><span class="mi">80</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># user driven</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">v_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_init</span>
        <span class="c1">## Handling temperature</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># model driven</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="mi">37</span>

        <span class="c1">############################################</span>
        <span class="c1">## PARMETERS FOR THE COMPARTIMENTAL MODEL ##</span>
        <span class="c1">############################################</span>
        <span class="c1"># compute variable MRG parameters, (usefull also if non MRG models)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axonD</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeD</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">paraD1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">paraD2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span><span class="p">,</span>\
            <span class="bp">self</span><span class="o">.</span><span class="n">nl</span> <span class="o">=</span> <span class="n">get_MRG_parameters</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="c1"># Morphological parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodelength</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">space_p1</span> <span class="o">=</span> <span class="mf">0.002</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">space_p2</span> <span class="o">=</span> <span class="mf">0.004</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">space_i</span> <span class="o">=</span> <span class="mf">0.004</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interlength</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">nodelength</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span><span class="p">))</span><span class="o">/</span><span class="mi">6</span>
        <span class="c1"># electrical parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rhoa</span> <span class="o">=</span> <span class="mf">0.7e6</span>   <span class="c1"># Ohm-um</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mycm</span> <span class="o">=</span> <span class="mf">0.1</span>     <span class="c1"># uF/cm2/lamella membrane</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mygm</span> <span class="o">=</span> <span class="mf">0.001</span>   <span class="c1"># S/cm2/lamella membrane</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rpn0</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoa</span><span class="o">*</span><span class="mf">.01</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((((</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeD</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">space_p1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span>\
            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">nodeD</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rpn1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoa</span><span class="o">*</span><span class="mf">.01</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((((</span><span class="bp">self</span><span class="o">.</span><span class="n">paraD1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">space_p1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span>\
            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">paraD1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rpn2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoa</span><span class="o">*</span><span class="mf">.01</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((((</span><span class="bp">self</span><span class="o">.</span><span class="n">paraD2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">space_p2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span>\
            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">paraD2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Rpx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rhoa</span><span class="o">*</span><span class="mf">.01</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">((((</span><span class="bp">self</span><span class="o">.</span><span class="n">axonD</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">space_i</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span>\
            <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">axonD</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="c1">#########################</span>
        <span class="c1">## morphology planning ##</span>
        <span class="c1">#########################</span>
        <span class="c1"># basic MRG sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;MYSA&#39;</span><span class="p">,</span> <span class="s1">&#39;FLUT&#39;</span><span class="p">,</span> <span class="s1">&#39;STIN&#39;</span><span class="p">,</span> <span class="s1">&#39;STIN&#39;</span><span class="p">,</span> <span class="s1">&#39;STIN&#39;</span><span class="p">,</span> <span class="s1">&#39;STIN&#39;</span><span class="p">,</span> <span class="s1">&#39;STIN&#39;</span><span class="p">,</span>\
            <span class="s1">&#39;STIN&#39;</span><span class="p">,</span> <span class="s1">&#39;FLUT&#39;</span><span class="p">,</span> <span class="s1">&#39;MYSA&#39;</span><span class="p">]</span>
        <span class="c1"># basic MRG starts with the node, if needed, adapt the sequence</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># no Rotation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelength</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="p">:</span>
            <span class="c1"># rotation of less than 1 MYSA</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span> <span class="o">=</span> <span class="n">rotate_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="p">:</span>
            <span class="c1"># rotation of 1 MYSA and less than one FLUT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span> <span class="o">=</span> <span class="n">rotate_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span> <span class="o">-</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">+</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="p">:</span>
            <span class="c1"># rotation of 1 MYSA, 1 FLUT and less than a STIN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span> <span class="o">=</span> <span class="n">rotate_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span> <span class="o">-</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">+</span>\
            <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="p">:</span>
            <span class="c1"># rotation of 1 MYSA, 1 FLUT, 1 STIN and less than a STIN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span> <span class="o">=</span> <span class="n">rotate_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span> <span class="o">-</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">+</span> \
            <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="p">:</span>
            <span class="c1"># rotation of 1 MYSA, 1 FLUT, 2 STIN and less than a STIN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span> <span class="o">=</span> <span class="n">rotate_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span> <span class="o">-</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">+</span>\
            <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="p">:</span>
            <span class="c1"># rotation of 1 MYSA, 1 FLUT, 3 STIN and less than a STIN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span> <span class="o">=</span> <span class="n">rotate_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span> <span class="o">-</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">+</span> \
            <span class="mi">5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="p">:</span>
            <span class="c1"># rotation of 1 MYSA, 1 FLUT, 4 STIN and less than a STIN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span> <span class="o">=</span> <span class="n">rotate_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span> <span class="o">-</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">+</span> \
            <span class="mi">6</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="p">:</span>
            <span class="c1"># rotation of 1 MYSA, 1 FLUT, 5 STIN and less than a STIN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span> <span class="o">=</span> <span class="n">rotate_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span> <span class="o">-</span>\
                <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">-</span> <span class="mi">5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">+</span> \
            <span class="mi">6</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="p">:</span>
            <span class="c1"># rotation of 1 MYSA, 1 FLUT, 6 STIN and less than a FLUT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span> <span class="o">=</span> <span class="n">rotate_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span> <span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">deltax</span> <span class="o">-</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">interlength</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># rotation of 1 MYSA, 2 FLUT, 6 STIN and less than a MYSA</span>
            <span class="c1"># WARNING FOR DEV : the unprobable case of a node cut in two halfs is not considered...</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span> <span class="o">=</span> <span class="n">rotate_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MRG_Sequence</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deltax</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span><span class="p">)</span>
        <span class="c1">################</span>
        <span class="c1">## morphology ##</span>
        <span class="c1">################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axonnodes</span> <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># number of nodes in the axon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="p">[]</span>          <span class="c1"># list of nodes in the axon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paranodes1</span> <span class="o">=</span> <span class="mi">0</span>     <span class="c1"># number of MYSA in the axon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span> <span class="o">=</span> <span class="p">[]</span>          <span class="c1"># list of MYSA in the axon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">paranodes2</span> <span class="o">=</span> <span class="mi">0</span>     <span class="c1"># number of FLUT in the axon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span> <span class="o">=</span> <span class="p">[]</span>          <span class="c1"># list of FLUT in the axon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axoninter</span> <span class="o">=</span> <span class="mi">0</span>      <span class="c1"># number of STIN in the axon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span> <span class="o">=</span> <span class="p">[]</span>          <span class="c1"># list of STIN in the axon</span>

        <span class="n">prov_length</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nsec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_section_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_section_kind</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">prov_length</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">:</span>
            <span class="c1"># axon is too short, create a section</span>
            <span class="n">pos_in_sequence</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsec</span><span class="p">)</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span><span class="p">)</span>    <span class="c1"># find the current position in the node sequence</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span><span class="p">[</span><span class="n">pos_in_sequence</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                <span class="c1"># you need to create a node</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;node[</span><span class="si">%d</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">axonnodes</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axonnodes</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axonnodes</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Nsec</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># increment the prov length and check it is not to much</span>
                <span class="k">if</span> <span class="n">prov_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelength</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">:</span>
                    <span class="c1"># it will be the last section to add to the axon</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_section_kind</span> <span class="o">=</span> <span class="s1">&#39;node&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_section_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">-</span> <span class="n">prov_length</span>
                <span class="n">prov_length</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelength</span>
                <span class="c1"># CONNECT THE NODE TO ITS PARENT: a node can only have a MYSA for parent, check it&#39;s not the start...</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">paranodes1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span><span class="p">[</span><span class="n">pos_in_sequence</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MYSA&#39;</span><span class="p">:</span>
                <span class="c1"># you need to create a MYSA</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;MYSA[</span><span class="si">%d</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">paranodes1</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;MYSA&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paranodes1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paranodes1</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Nsec</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># increment the prov length and check it is not to much</span>
                <span class="k">if</span> <span class="n">prov_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">:</span>
                    <span class="c1"># it will be the last section to add to the axon</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_section_kind</span> <span class="o">=</span> <span class="s1">&#39;MYSA&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_section_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">-</span> <span class="n">prov_length</span>
                <span class="n">prov_length</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span>
                <span class="c1"># CONNECT THE MYSA TO ITS PARENT: a MYSA can have for parent a node or a FLUT, check it&#39;s not the start...</span>
                <span class="n">connect_to_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span><span class="p">[</span><span class="n">pos_in_sequence</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># get parent type</span>
                <span class="k">if</span> <span class="n">connect_to_type</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">axonnodes</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">connect_to_type</span> <span class="o">==</span> <span class="s1">&#39;FLUT&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">paranodes2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span><span class="p">[</span><span class="n">pos_in_sequence</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;FLUT&#39;</span><span class="p">:</span>
                <span class="c1"># you need to create a FLUT</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;FLUT[</span><span class="si">%d</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">paranodes2</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;FLUT&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paranodes2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">paranodes2</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Nsec</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># increment the prov length and check it is not to much</span>
                <span class="k">if</span> <span class="n">prov_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">:</span>
                    <span class="c1"># it will be the last section to add to the axon</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_section_kind</span> <span class="o">=</span> <span class="s1">&#39;FLUT&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_section_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">-</span> <span class="n">prov_length</span>
                <span class="n">prov_length</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span>
                <span class="c1"># CONNECT THE FLUT TO ITS PARENT: a FLUT can have for parent a MYSA of a STIN, check it&#39;s not the start...</span>
                <span class="n">connect_to_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span><span class="p">[</span><span class="n">pos_in_sequence</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="c1"># get parent type</span>
                <span class="k">if</span> <span class="n">connect_to_type</span> <span class="o">==</span> <span class="s1">&#39;MYSA&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">paranodes1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">connect_to_type</span> <span class="o">==</span> <span class="s1">&#39;STIN&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">axoninter</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># you need to create a STIN</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Section</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;STIN[</span><span class="si">%d</span><span class="s1">]&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">axoninter</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;STIN&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axoninter</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axoninter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Nsec</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># increment the prov length and check it is not to much</span>
                <span class="k">if</span> <span class="n">prov_length</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">interlength</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">:</span>
                    <span class="c1"># it will be the last section to add to the axon</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_section_kind</span> <span class="o">=</span> <span class="s1">&#39;STIN&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">last_section_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L</span> <span class="o">-</span> <span class="n">prov_length</span>
                <span class="n">prov_length</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interlength</span>
                <span class="c1"># CONNECT THE STIN TO ITS PARENT: a STIN can have for parent a STIN od a FLUT, check it&#39;s not the start...</span>
                <span class="n">connect_to_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span><span class="p">[</span><span class="n">pos_in_sequence</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">connect_to_type</span> <span class="o">==</span> <span class="s1">&#39;STIN&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">axoninter</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">connect_to_type</span> <span class="o">==</span> <span class="s1">&#39;FLUT&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">paranodes2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">rise_warning</span><span class="p">(</span><span class="s1">&#39;Warning, myelinated axon without node... this can cause latter errors and is maybe unwanted ?</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1">#logging.warning(&#39;Warning, myelinated axon without node... this can cause latter errors and is maybe unwanted ?\n&#39;)</span>

        <span class="c1">####################</span>
        <span class="c1">## programm model ##</span>
        <span class="c1">####################</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="c1"># adjust the length of the first section</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;MYSA&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">this_ax_sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;FLUT&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># should be a STIN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_section_size</span>
        <span class="c1"># adjust the length if the last section</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_section_kind</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_section_size</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_section_kind</span> <span class="o">==</span> <span class="s1">&#39;MYSA&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_section_size</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_section_kind</span> <span class="o">==</span> <span class="s1">&#39;FLUT&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_section_size</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># should be a STIN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_section_size</span>
        <span class="c1"># define the geometry of the axon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axon__define_shape</span><span class="p">()</span>
        <span class="c1"># define the number of segments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__set_Nseg</span><span class="p">()</span>
        <span class="c1"># get nodes positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__get_seg_positions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__get_rec_positions</span><span class="p">()</span>

<div class="viewcode-block" id="myelinated.save"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="s1">&#39;axon.json&#39;</span><span class="p">,</span> <span class="n">extracel_context</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">intracel_context</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rec_context</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return axon as dictionary and eventually save it as json file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        save    : bool</span>
<span class="sd">            if True, save in json files</span>
<span class="sd">        fname   : str</span>
<span class="sd">            Path and Name of the saving file, by default &#39;axon.json&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ax_dic : dict</span>
<span class="sd">            dictionary containing all information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax_dic</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">extracel_context</span><span class="o">=</span><span class="n">extracel_context</span><span class="p">,</span> <span class="n">intracel_context</span><span class="o">=</span><span class="n">intracel_context</span><span class="p">,</span> <span class="n">rec_context</span><span class="o">=</span><span class="n">rec_context</span><span class="p">)</span>

        <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;myelinated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">myelinated</span>
        <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;thin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thin</span>
        <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;rec&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span>
        <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;node_shift&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span>
        <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">json_dump</span><span class="p">(</span><span class="n">ax_dic</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ax_dic</span></div>

<div class="viewcode-block" id="myelinated.load"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.load">[docs]</a>    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">extracel_context</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">intracel_context</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rec_context</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load all axon properties from a dictionary or a json file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data    : str or dict</span>
<span class="sd">            json file path or dictionary containing axon information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">ax_dic</span> <span class="o">=</span> <span class="n">json_load</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">ax_dic</span> <span class="o">=</span> <span class="n">data</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">extracel_context</span><span class="o">=</span><span class="n">extracel_context</span><span class="p">,</span> <span class="n">intracel_context</span><span class="o">=</span><span class="n">intracel_context</span><span class="p">,</span> <span class="n">rec_context</span><span class="o">=</span><span class="n">rec_context</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">myelinated</span> <span class="o">=</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;myelinated&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thin</span> <span class="o">=</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;thin&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec</span> <span class="o">=</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;rec&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_shift</span> <span class="o">=</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;node_shift&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">myelinated_models</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;MRG&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__compute_axon_parameters</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">intracel_context</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;intra_current_stim_positions&#39;</span><span class="p">])):</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;intra_current_stim_positions&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">stim_start</span> <span class="o">=</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;intra_current_stim_starts&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;intra_current_stim_durations&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="n">amplitude</span> <span class="o">=</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;intra_current_stim_amplitudes&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert_I_Clamp</span><span class="p">(</span><span class="n">position</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="n">stim_start</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;intra_voltage_stim_stimulus&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;intra_voltage_stim_position&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">stim</span> <span class="o">=</span> <span class="n">stimulus</span><span class="p">()</span>
                <span class="n">stim</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ax_dic</span><span class="p">[</span><span class="s1">&#39;intra_voltage_stim_stimulus&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">insert_V_Clamp</span><span class="p">(</span><span class="n">position</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="n">stim</span><span class="p">)</span></div>



    <span class="k">def</span> <span class="nf">__set_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the double cable model. For internal use only.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model           : str</span>
<span class="sd">            choice of conductance double-cable based model, possibly:</span>
<span class="sd">                &#39;MRG&#39;           : see [1] for details</span>
<span class="sd">                &#39;Gaines_motor&#39;  : Gaines motor model, see [2]</span>
<span class="sd">                &#39;Gaines_sensory&#39;: Gaines sensory model, see [2]</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        scientific sources for models:</span>
<span class="sd">        [1] McIntyre CC, Richardson AG, and Grill WM. Modeling the excitability of mammalian nerve fibers: influence of afterpotentials on the recovery cycle. Journal of Neurophysiology 87:995-1006, 2002.</span>
<span class="sd">        [2] Gaines, J. L., Finn, K. E., Slopsema, J. P., Heyboer, L. A.,  Polasek, K. H. (2018). A model of motor and sensory axon activation in the median nerve using surface electrical stimulation. Journal of computational neuroscience, 45(1), 29-43.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="n">n</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">n</span><span class="o">.</span><span class="n">diam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeD</span>
            <span class="n">n</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodelength</span>
            <span class="n">n</span><span class="o">.</span><span class="n">Ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhoa</span><span class="o">/</span><span class="mi">10000</span>
            <span class="n">n</span><span class="o">.</span><span class="n">cm</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_sensory&#39;</span><span class="p">:</span>
                <span class="n">n</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;node_sensory&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_motor&#39;</span><span class="p">:</span>
                <span class="n">n</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;node_motor&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">n</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;axnode&#39;</span><span class="p">)</span>
            <span class="n">n</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;extracellular&#39;</span><span class="p">)</span>
            <span class="n">n</span><span class="o">.</span><span class="n">xraxial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rpn0</span>
            <span class="n">n</span><span class="o">.</span><span class="n">xg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e10</span>
            <span class="n">n</span><span class="o">.</span><span class="n">xc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">m</span><span class="o">.</span><span class="n">diam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
            <span class="n">m</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength1</span>
            <span class="n">m</span><span class="o">.</span><span class="n">Ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhoa</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paraD1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">10000</span>
            <span class="n">m</span><span class="o">.</span><span class="n">cm</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">paraD1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_sensory&#39;</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;mysa_sensory&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_motor&#39;</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;mysa_motor&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;pas&#39;</span><span class="p">)</span>
                <span class="n">m</span><span class="o">.</span><span class="n">g_pas</span> <span class="o">=</span> <span class="mf">0.001</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">paraD1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span>
                <span class="n">m</span><span class="o">.</span><span class="n">e_pas</span> <span class="o">=</span> <span class="o">-</span><span class="mi">80</span>
            <span class="n">m</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;extracellular&#39;</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">xraxial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rpn1</span>
            <span class="n">m</span><span class="o">.</span><span class="n">xg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mygm</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">xc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mycm</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">f</span><span class="o">.</span><span class="n">diam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
            <span class="n">f</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paralength2</span>
            <span class="n">f</span><span class="o">.</span><span class="n">Ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhoa</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">paraD2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">10000</span>
            <span class="n">f</span><span class="o">.</span><span class="n">cm</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">paraD2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_sensory&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;flut_sensory&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_motor&#39;</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;flut_motor&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;pas&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">g_pas</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">paraD2</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span>
                <span class="n">f</span><span class="o">.</span><span class="n">e_pas</span> <span class="o">=</span> <span class="o">-</span><span class="mi">80</span>
            <span class="n">f</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;extracellular&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">xraxial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rpn2</span>
            <span class="n">f</span><span class="o">.</span><span class="n">xg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mygm</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">xc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mycm</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">:</span>
            <span class="n">s</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">s</span><span class="o">.</span><span class="n">diam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
            <span class="n">s</span><span class="o">.</span><span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interlength</span>
            <span class="n">s</span><span class="o">.</span><span class="n">Ra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rhoa</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axonD</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">10000</span>
            <span class="n">s</span><span class="o">.</span><span class="n">cm</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axonD</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span>
            <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_sensory&#39;</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;stin_sensory&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_motor&#39;</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;stin_motor&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;pas&#39;</span><span class="p">)</span>
                <span class="n">s</span><span class="o">.</span><span class="n">g_pas</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">axonD</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span>
                <span class="n">s</span><span class="o">.</span><span class="n">e_pas</span> <span class="o">=</span> <span class="o">-</span><span class="mi">80</span>
            <span class="n">s</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;extracellular&#39;</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">xraxial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Rpx</span>
            <span class="n">s</span><span class="o">.</span><span class="n">xg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mygm</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">s</span><span class="o">.</span><span class="n">xc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mycm</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nl</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

<div class="viewcode-block" id="myelinated.set_Markov_Nav"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.set_Markov_Nav">[docs]</a>    <span class="k">def</span> <span class="nf">set_Markov_Nav</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_nodes</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change typical particle-Na sodium in Hodgking-Huxley formalism to Markov-channel population model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        list_of_nodes   : list, array, np.array</span>
<span class="sd">            list of Nodes of Ranier to modify, if empty, all nodes sodium channels are changed</span>

<span class="sd">        Note</span>
<span class="sd">        ----</span>
<span class="sd">        based on:</span>
<span class="sd">        Yi, G., and Grill, W. M. (2020). Kilohertz waveforms optimized to produce closed-state Na+ channel inactivation eliminate onset response in nerve conduction block. PLoS computational biology, 16(6), e1007766.</span>

<span class="sd">        !!! TO USE WITH CAUTION !!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">list_of_nodes</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">list_of_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axonnodes</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;MRG&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">NoR</span> <span class="ow">in</span> <span class="n">list_of_nodes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NoR</span><span class="p">]</span><span class="o">.</span><span class="n">gnapbar_axnode</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NoR</span><span class="p">]</span><span class="o">.</span><span class="n">gnabar_axnode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_motor&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">NoR</span> <span class="ow">in</span> <span class="n">list_of_nodes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NoR</span><span class="p">]</span><span class="o">.</span><span class="n">gnapbar_node_motor</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NoR</span><span class="p">]</span><span class="o">.</span><span class="n">gnabar_node_motor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_sensory&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">NoR</span> <span class="ow">in</span> <span class="n">list_of_nodes</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NoR</span><span class="p">]</span><span class="o">.</span><span class="n">gnapbar_node_sensory</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NoR</span><span class="p">]</span><span class="o">.</span><span class="n">gnabar_node_sensory</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># insert channel specific mechanisms</span>
        <span class="c1"># Nav1.1 models fast sodium</span>
        <span class="c1"># Nav1.6 models persistant sodium, to be confirmed, Warning gnabar is different than MRG and Gaines</span>
        <span class="k">for</span> <span class="n">NoR</span> <span class="ow">in</span> <span class="n">list_of_nodes</span><span class="p">:</span>
            <span class="c1"># insert Nav1.1 model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NoR</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;na11a&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NoR</span><span class="p">]</span><span class="o">.</span><span class="n">gbar_na11a</span> <span class="o">=</span> <span class="mf">11.9</span>
            <span class="c1"># insert Nav1.6 model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NoR</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s1">&#39;na16a&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NoR</span><span class="p">]</span><span class="o">.</span><span class="n">gbar_na16a</span> <span class="o">=</span> <span class="mf">0.01</span>
            <span class="c1">## WARINING -  Sodium Nernst potential is defined for axnode as ena_axnode, and is common</span>
            <span class="c1">## for fast and persistant sodium channels (see lines 98 and 99 in AXNOE.mod)</span>
            <span class="c1">## This is not the case for Nav1.x, which uses the NEURON instruction USEION na READ ena</span>
            <span class="c1">## meaning the following line is tuning directly the na11a and na16a mechanisms</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">NoR</span><span class="p">]</span><span class="o">.</span><span class="n">ena</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span> <span class="o">=</span> <span class="n">list_of_nodes</span></div>

    <span class="k">def</span> <span class="nf">__set_Nseg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the number of segments automatically acording initialization. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                <span class="n">n</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span><span class="p">[</span><span class="s1">&#39;MYSA&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span><span class="p">[</span><span class="s1">&#39;FLUT&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span><span class="p">[</span><span class="s1">&#39;STIN&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_Nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axonnodes</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span><span class="p">[</span><span class="s1">&#39;node&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MYSA_Nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paranodes1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span><span class="p">[</span><span class="s1">&#39;MYSA&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FLUT_Nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paranodes2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span><span class="p">[</span><span class="s1">&#39;FLUT&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">STIN_Nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axoninter</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span><span class="p">[</span><span class="s1">&#39;STIN&#39;</span><span class="p">]</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># all sections will have a fixed number of segment chosen by user</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                <span class="n">n</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">:</span>
                <span class="n">s</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_Nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axonnodes</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MYSA_Nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paranodes1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FLUT_Nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">paranodes2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">STIN_Nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axoninter</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nseg_per_sec</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># here comes the dlambda rule</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_Nseg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">MYSA_Nseg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">FLUT_Nseg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">STIN_Nseg</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq_min</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># uniform meshing</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                    <span class="n">Nseg</span> <span class="o">=</span> <span class="n">d_lambda_rule</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_lambda</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                    <span class="n">n</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="n">Nseg</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">node_Nseg</span> <span class="o">+=</span> <span class="n">Nseg</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">:</span>
                    <span class="n">Nseg</span> <span class="o">=</span> <span class="n">Nseg</span> <span class="o">=</span> <span class="n">d_lambda_rule</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_lambda</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
                    <span class="n">m</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="n">Nseg</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">MYSA_Nseg</span> <span class="o">+=</span> <span class="n">Nseg</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">:</span>
                    <span class="n">Nseg</span> <span class="o">=</span> <span class="n">Nseg</span> <span class="o">=</span> <span class="n">d_lambda_rule</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_lambda</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="n">Nseg</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FLUT_Nseg</span> <span class="o">+=</span> <span class="n">Nseg</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">:</span>
                    <span class="n">Nseg</span> <span class="o">=</span> <span class="n">Nseg</span> <span class="o">=</span> <span class="n">d_lambda_rule</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_lambda</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="n">Nseg</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">STIN_Nseg</span> <span class="o">+=</span> <span class="n">Nseg</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># non-uniform meshing</span>
                <span class="n">freqs</span> <span class="o">=</span> <span class="n">create_Nseg_freq_shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsec</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh_shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="p">,</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">freq_min</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">alpha_max</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="p">)):</span>
                    <span class="n">sec_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="n">sec_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_index</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                        <span class="n">Nseg</span> <span class="o">=</span> <span class="n">d_lambda_rule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_lambda</span><span class="p">,</span> <span class="n">freqs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">sec_index</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="n">Nseg</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">node_Nseg</span> <span class="o">+=</span> <span class="n">Nseg</span>
                    <span class="k">elif</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;MYSA&#39;</span><span class="p">:</span>
                        <span class="n">Nseg</span> <span class="o">=</span> <span class="n">d_lambda_rule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_lambda</span><span class="p">,</span> <span class="n">freqs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="n">sec_index</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="n">Nseg</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">MYSA_Nseg</span> <span class="o">+=</span> <span class="n">Nseg</span>
                    <span class="k">elif</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;FLUT&#39;</span><span class="p">:</span>
                        <span class="n">Nseg</span> <span class="o">=</span> <span class="n">d_lambda_rule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_lambda</span><span class="p">,</span> <span class="n">freqs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="n">sec_index</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="n">Nseg</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">FLUT_Nseg</span> <span class="o">+=</span> <span class="n">Nseg</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1"># should be STIN</span>
                        <span class="n">Nseg</span> <span class="o">=</span> <span class="n">d_lambda_rule</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_lambda</span><span class="p">,</span> <span class="n">freqs</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="n">sec_index</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">nseg</span> <span class="o">=</span> <span class="n">Nseg</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">STIN_Nseg</span> <span class="o">+=</span> <span class="n">Nseg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_Nseg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">MYSA_Nseg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">FLUT_Nseg</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">STIN_Nseg</span>

    <span class="k">def</span> <span class="nf">__get_seg_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get segment positions, for internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x_offset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">x_nodes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodes_index</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="p">)):</span>
            <span class="n">sec_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">sec_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_index</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
            <span class="k">if</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                <span class="n">x_nodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_offset</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">allseg</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_offset</span><span class="p">)</span>
                        <span class="n">nodes_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">x_seg</span> <span class="o">=</span> <span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_offset</span>
                        <span class="k">if</span> <span class="n">x_seg</span> <span class="o">!=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_seg</span><span class="p">)</span>
                            <span class="n">nodes_index</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">x_offset</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span>
            <span class="k">elif</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;MYSA&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">allseg</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_offset</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">x_seg</span> <span class="o">=</span> <span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_offset</span>
                        <span class="k">if</span> <span class="n">x_seg</span> <span class="o">!=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_seg</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">x_offset</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span>
            <span class="k">elif</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;FLUT&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">allseg</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_offset</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">x_seg</span> <span class="o">=</span> <span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_offset</span>
                        <span class="k">if</span> <span class="n">x_seg</span> <span class="o">!=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_seg</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">x_offset</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># should be STIN</span>
                <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">allseg</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_offset</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">x_seg</span> <span class="o">=</span> <span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_offset</span>
                        <span class="k">if</span> <span class="n">x_seg</span> <span class="o">!=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_seg</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seg</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">x_offset</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="n">sec_index</span><span class="p">]</span><span class="o">.</span><span class="n">L</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nodes_index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__get_rec_positions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the position of points with voltage recording. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span> <span class="o">==</span> <span class="s1">&#39;nodes&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x_rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>

    <span class="c1">###############################</span>
    <span class="c1">## Intracellular stimulation ##</span>
    <span class="c1">###############################</span>
<div class="viewcode-block" id="myelinated.insert_I_Clamp_node"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.insert_I_Clamp_node">[docs]</a>    <span class="k">def</span> <span class="nf">insert_I_Clamp_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">t_start</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a IC clamp stimulation on a Ranvier node at its midd point position</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index       : int</span>
<span class="sd">            node number of the node to stimulate</span>
<span class="sd">        t_start     : float</span>
<span class="sd">            starting time (ms)</span>
<span class="sd">        duration    : float</span>
<span class="sd">            duration of the pulse(ms)</span>
<span class="sd">        amplitude   : float</span>
<span class="sd">            amplitude of the pulse (nA)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add the stimulation to the axon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_current_stim</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">IClamp</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
        <span class="c1"># modify the stimulation parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_current_stim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="n">t_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_current_stim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">dur</span> <span class="o">=</span> <span class="n">duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_current_stim</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">amp</span> <span class="o">=</span> <span class="n">amplitude</span>
        <span class="c1"># save the stimulation parameter for results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_current_stim_positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_current_stim_starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t_start</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_current_stim_durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_current_stim_amplitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">amplitude</span><span class="p">)</span></div>

<div class="viewcode-block" id="myelinated.insert_I_Clamp"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.insert_I_Clamp">[docs]</a>    <span class="k">def</span> <span class="nf">insert_I_Clamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">t_start</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a IC clamp stimulation at the midd point of the nearest node to the specified position</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        position    : float</span>
<span class="sd">            relative position over the axon</span>
<span class="sd">        t_start     : float</span>
<span class="sd">            starting time (ms)</span>
<span class="sd">        duration    :</span>
<span class="sd">            duration of the pulse(ms)</span>
<span class="sd">        amplitude   :</span>
<span class="sd">            amplitude of the pulse (nA)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># adapt position to the number of sections</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">position</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axonnodes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_I_Clamp_node</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">t_start</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">amplitude</span><span class="p">)</span></div>

<div class="viewcode-block" id="myelinated.insert_V_Clamp_node"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.insert_V_Clamp_node">[docs]</a>    <span class="k">def</span> <span class="nf">insert_V_Clamp_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">stimulus</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a V clamp stimulation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index       : int</span>
<span class="sd">            node number of the node to stimulate</span>
<span class="sd">        stimulus    : stimulus object</span>
<span class="sd">            stimulus for the clamp, see Stimulus.py for more information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># add the stimulation to the axon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_voltage_stim</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">VClamp</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="c1"># save the stimulation parameter for results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_voltage_stim_position</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
        <span class="c1"># save the stimulus for later use</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_voltage_stim_stimulus</span> <span class="o">=</span> <span class="n">stimulus</span>
        <span class="c1"># set fake duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intra_voltage_stim</span><span class="o">.</span><span class="n">dur</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e9</span></div>

<div class="viewcode-block" id="myelinated.insert_V_Clamp"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.insert_V_Clamp">[docs]</a>    <span class="k">def</span> <span class="nf">insert_V_Clamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">stimulus</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a V clamp stimulation at the midd point of the nearest node to the specified position</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        position    : float</span>
<span class="sd">            relative position over the axon</span>
<span class="sd">        stimulus    : stimulus object</span>
<span class="sd">            stimulus for the clamp, see Stimulus.py for more information</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># adapt position to the number of sections</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">position</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axonnodes</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">insert_V_Clamp_node</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">stimulus</span><span class="p">)</span></div>

    <span class="c1">##############################</span>
    <span class="c1">## Result recording methods ##</span>
    <span class="c1">##############################</span>
    <span class="k">def</span> <span class="nf">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reclist</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">key_node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>\
        <span class="n">key_MYSA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_FLUT</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_STIN</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To automate the methods set_recorder. For internal use only.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reclist     : neuron.h.List</span>
<span class="sd">            List in witch the reccorders should be saved</span>
<span class="sd">        key         : str</span>
<span class="sd">            Name of the key which should be recorded, if None result of the recording set to [0],</span>
<span class="sd">            by default None</span>
<span class="sd">        single_mod  : bool</span>
<span class="sd">            if True key will be used for all the section, else specific key will be used in each</span>
<span class="sd">            section, by default True</span>
<span class="sd">        key_node    : str</span>
<span class="sd">            Name of the key which should be recorded in node, if None result of the recording set</span>
<span class="sd">            to [0], by default None</span>
<span class="sd">        key_MYSA    : str</span>
<span class="sd">            Name of the key which should be recorded in MYSA, if None result of the recording set</span>
<span class="sd">            to [0], by default None</span>
<span class="sd">        key_FLUT    : str</span>
<span class="sd">            Name of the key which should be recorded in FLUT, if None result of the recording set</span>
<span class="sd">            to [0], by default None</span>
<span class="sd">        key_STIN    : str</span>
<span class="sd">            Name of the key which should be recorded in STIN, if None result of the recording set</span>
<span class="sd">            to [0], by default None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">single_mod</span><span class="p">:</span>
            <span class="n">key_node</span><span class="p">,</span> <span class="n">key_MYSA</span><span class="p">,</span> <span class="n">key_FLUT</span><span class="p">,</span> <span class="n">key_STIN</span> <span class="o">=</span> <span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">key</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span> <span class="o">==</span> <span class="s1">&#39;nodes&#39;</span><span class="p">:</span>

            <span class="c1"># recording only on middle of all nodes</span>
            <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">n</span><span class="p">(</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">key_node</span><span class="p">),</span> <span class="n">sec</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rec</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># recording on all segments</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="p">)):</span>
                <span class="n">sec_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sec_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_index</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">rec</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">sec_index</span><span class="p">](</span><span class="n">position</span><span class="p">),</span> <span class="n">key_node</span><span class="p">),</span>\
                                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">sec_index</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rec</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;MYSA&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key_MYSA</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">rec</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="n">sec_index</span><span class="p">](</span><span class="n">position</span><span class="p">),</span> <span class="n">key_MYSA</span><span class="p">),</span> \
                                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="n">sec_index</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rec</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>                            
                        <span class="n">reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;FLUT&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key_FLUT</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">rec</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="n">sec_index</span><span class="p">](</span><span class="n">position</span><span class="p">),</span> <span class="n">key_FLUT</span><span class="p">),</span> \
                                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="n">sec_index</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rec</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span> 
                        <span class="n">reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1"># should be STIN</span>
                        <span class="k">if</span> <span class="n">key_STIN</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">rec</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="n">sec_index</span><span class="p">](</span><span class="n">position</span><span class="p">),</span> <span class="n">key_STIN</span><span class="p">),</span> \
                                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="n">sec_index</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">rec</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span> 
                        <span class="n">reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reclist</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert reclist in np.array To automate methods set_recorder. For internal use only.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        reclist     : neuron.h.List</span>
<span class="sd">            List in witch the reccorders are saved</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        val         : np.array</span>
<span class="sd">            array of every recorded value for all rec point and time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span> <span class="o">==</span> <span class="s1">&#39;nodes&#39;</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axonnodes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_rec</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">val</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_get_var_from_mod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_MYSA</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_FLUT</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_STIN</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return a column with value in every recording point of a constant from a mod. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec</span> <span class="o">==</span> <span class="s1">&#39;nodes&#39;</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">key_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">val</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">key_node</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x_rec</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">i</span><span class="o">=-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="p">)):</span>
                <span class="n">sec_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_type</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="n">sec_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axon_path_index</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">position</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rec_position_list</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;node&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key_node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">sec_index</span><span class="p">](</span><span class="n">position</span><span class="p">),</span> <span class="n">key_node</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;MYSA&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key_MYSA</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MYSA</span><span class="p">[</span><span class="n">sec_index</span><span class="p">](</span><span class="n">position</span><span class="p">),</span> <span class="n">key_MYSA</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="n">sec_type</span> <span class="o">==</span> <span class="s1">&#39;FLUT&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">key_FLUT</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FLUT</span><span class="p">[</span><span class="n">sec_index</span><span class="p">](</span><span class="n">position</span><span class="p">),</span> <span class="n">key_FLUT</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1"># should be STIN</span>
                        <span class="k">if</span> <span class="n">key_STIN</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">STIN</span><span class="p">[</span><span class="n">sec_index</span><span class="p">](</span><span class="n">position</span><span class="p">),</span> <span class="n">key_STIN</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">val</span>

<div class="viewcode-block" id="myelinated.set_membrane_voltage_recorders"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.set_membrane_voltage_recorders">[docs]</a>    <span class="k">def</span> <span class="nf">set_membrane_voltage_recorders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the membrane voltage recording. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vreclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;_ref_v&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vreclist</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="myelinated.get_membrane_voltage"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.get_membrane_voltage">[docs]</a>    <span class="k">def</span> <span class="nf">get_membrane_voltage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the membrane voltage at the end of simulation. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vreclist</span><span class="p">)</span></div>

<div class="viewcode-block" id="myelinated.set_membrane_current_recorders"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.set_membrane_current_recorders">[docs]</a>    <span class="k">def</span> <span class="nf">set_membrane_current_recorders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the membrane current recording. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ireclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;_ref_i_membrane&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ireclist</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="myelinated.get_membrane_current"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.get_membrane_current">[docs]</a>    <span class="k">def</span> <span class="nf">get_membrane_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the membrane current at the end of simulation. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ireclist</span><span class="p">)</span></div>


<div class="viewcode-block" id="myelinated.set_ionic_current_recorders"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.set_ionic_current_recorders">[docs]</a>    <span class="k">def</span> <span class="nf">set_ionic_current_recorders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the ionic channels current recording. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;MRG&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ina_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ina_reclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_ina_axnode&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inap_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inap_reclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_inap_axnode&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ik_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ik_reclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_ik_axnode&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">il_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">il_reclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_il_axnode&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1">#should be Gaines, motor or sensory</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_motor&#39;</span><span class="p">:</span>
                <span class="n">key_mod</span> <span class="o">=</span> <span class="s1">&#39;_motor&#39;</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">key_mod</span> <span class="o">=</span> <span class="s1">&#39;_sensory&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ina_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ina_reclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_ina_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">inap_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inap_reclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_inap_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ik_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ik_reclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_ik_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_ik_mysa&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_ik_flut&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_ik_stin&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>
                        
            <span class="bp">self</span><span class="o">.</span><span class="n">ikf_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ikf_reclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_ikf_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span><span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_ikf_mysa&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_ikf_flut&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_ikf_stin&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">iq_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iq_reclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_iq_mysa&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_iq_flut&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_iq_stin&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">il_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">il_reclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_il_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_il_mysa&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_il_flut&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_il_stin&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span></div>

<div class="viewcode-block" id="myelinated.get_ionic_current"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.get_ionic_current">[docs]</a>    <span class="k">def</span> <span class="nf">get_ionic_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the ionic channels currents at the end of simulation. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ina_reclist</span><span class="p">)]</span>
        <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inap_reclist</span><span class="p">)]</span>
        <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ik_reclist</span><span class="p">)]</span>
        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_motor&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_sensory&#39;</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ikf_reclist</span><span class="p">)]</span>
            <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">iq_reclist</span><span class="p">)]</span>
        <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">il_reclist</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="myelinated.set_particules_values_recorders"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.set_particules_values_recorders">[docs]</a>    <span class="k">def</span> <span class="nf">set_particules_values_recorders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the particules current recording. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;MRG&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mreclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mreclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_m_axnode&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mpreclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mpreclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_mp_axnode&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hreclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hreclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_h_axnode&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sreclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sreclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_s_axnode&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1">#should be Gaines, motor or sensory</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_motor&#39;</span><span class="p">:</span>
                <span class="n">key_mod</span> <span class="o">=</span> <span class="s1">&#39;_motor&#39;</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">key_mod</span> <span class="o">=</span> <span class="s1">&#39;_sensory&#39;</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mreclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mreclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_m_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mpreclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mpreclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_mp_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">hreclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hreclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_h_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">sreclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sreclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_s_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_s_mysa&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_s_flut&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_s_stin&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">nreclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nreclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_n_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_n_mysa&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_n_flut&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_n_stin&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">qreclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_recorders_with_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qreclist</span><span class="p">,</span> <span class="n">single_mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                <span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_q_mysa&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_q_flut&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_q_stin&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span></div>

<div class="viewcode-block" id="myelinated.get_particles_values"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.get_particles_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_particles_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the particules values at the end of simulation. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mreclist</span><span class="p">)]</span>
        <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mpreclist</span><span class="p">)]</span>
        <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hreclist</span><span class="p">)]</span>
        <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sreclist</span><span class="p">)]</span>
        <span class="k">if</span>  <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_motor&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_sensory&#39;</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nreclist</span><span class="p">)]</span>
            <span class="n">results</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_recorders_from_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qreclist</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">results</span></div>
    

<div class="viewcode-block" id="myelinated.set_conductance_recorders"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.set_conductance_recorders">[docs]</a>    <span class="k">def</span> <span class="nf">set_conductance_recorders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the ionic channels conductance recording. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_particules_values_recorders</span><span class="p">()</span></div>



<div class="viewcode-block" id="myelinated.get_ionic_conductance"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.get_ionic_conductance">[docs]</a>    <span class="k">def</span> <span class="nf">get_ionic_conductance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the ionic channels conductance at the end of simulation. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;MRG&#39;</span><span class="p">:</span>
            <span class="n">m_ax</span><span class="p">,</span> <span class="n">mp_ax</span><span class="p">,</span> <span class="n">h_ax</span><span class="p">,</span> <span class="n">s_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_particles_values</span><span class="p">()</span>
            <span class="n">gnabar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_var_from_mod</span><span class="p">(</span><span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_gnabar_axnode&#39;</span><span class="p">)</span>
            <span class="n">gnapbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_var_from_mod</span><span class="p">(</span><span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_gnapbar_axnode&#39;</span><span class="p">)</span>
            <span class="n">gkbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_var_from_mod</span><span class="p">(</span><span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_gkbar_axnode&#39;</span><span class="p">)</span>
            <span class="n">glbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_var_from_mod</span><span class="p">(</span><span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_gl_axnode&#39;</span><span class="p">)</span>
            <span class="n">gibar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_var_from_mod</span><span class="p">(</span><span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_g_pas&#39;</span><span class="p">,</span> <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_g_pas&#39;</span><span class="p">,</span> <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_g_pas&#39;</span><span class="p">)</span>
            <span class="n">g_na_ax</span> <span class="o">=</span> <span class="n">gnabar</span> <span class="o">*</span> <span class="n">m_ax</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">h_ax</span>
            <span class="n">g_nap_ax</span> <span class="o">=</span> <span class="n">gnapbar</span> <span class="o">*</span> <span class="n">mp_ax</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">g_k_ax</span> <span class="o">=</span> <span class="n">gkbar</span> <span class="o">*</span> <span class="n">s_ax</span>
            <span class="n">g_l_ax</span> <span class="o">=</span> <span class="n">glbar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">glbar</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
            <span class="n">g_i_ax</span> <span class="o">=</span> <span class="n">gibar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">gibar</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>

            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">g_na_ax</span><span class="p">,</span> <span class="n">g_nap_ax</span><span class="p">,</span> <span class="n">g_k_ax</span><span class="p">,</span> <span class="n">g_l_ax</span><span class="p">,</span> <span class="n">g_i_ax</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1">#should be Gaines, motor or sensory</span>
            <span class="n">m_ax</span><span class="p">,</span> <span class="n">mp_ax</span><span class="p">,</span> <span class="n">h_ax</span><span class="p">,</span> <span class="n">s_ax</span><span class="p">,</span> <span class="n">n_ax</span><span class="p">,</span> <span class="n">q_ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_particles_values</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span> <span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;Gaines_motor&#39;</span><span class="p">:</span>
                <span class="n">key_mod</span> <span class="o">=</span> <span class="s1">&#39;_motor&#39;</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">key_mod</span> <span class="o">=</span> <span class="s1">&#39;_sensory&#39;</span>

            <span class="n">gnabar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_var_from_mod</span><span class="p">(</span><span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_gnabar_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>
            <span class="n">gnapbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_var_from_mod</span><span class="p">(</span><span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_gnapbar_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>
            <span class="n">gkbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_var_from_mod</span><span class="p">(</span><span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_gkbar_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_gkbar_mysa&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_gkbar_flut&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_gkbar_stin&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>
            <span class="n">gkfbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_var_from_mod</span><span class="p">(</span><span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_gkf_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_gkf_mysa&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_gkf_flut&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_gkf_stin&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>
            <span class="n">glbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_var_from_mod</span><span class="p">(</span><span class="n">key_node</span><span class="o">=</span><span class="s1">&#39;_ref_gl_node&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_gl_mysa&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_gl_flut&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_gl_stin&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>
            <span class="n">gqbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_var_from_mod</span><span class="p">(</span><span class="n">key_MYSA</span><span class="o">=</span><span class="s1">&#39;_ref_gq_mysa&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span>\
                <span class="n">key_FLUT</span><span class="o">=</span><span class="s1">&#39;_ref_gq_flut&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">,</span> <span class="n">key_STIN</span><span class="o">=</span><span class="s1">&#39;_ref_gq_stin&#39;</span><span class="o">+</span><span class="n">key_mod</span><span class="p">)</span>

            <span class="n">g_na_ax</span> <span class="o">=</span> <span class="n">gnabar</span> <span class="o">*</span> <span class="n">m_ax</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">h_ax</span>
            <span class="n">g_nap_ax</span> <span class="o">=</span> <span class="n">gnapbar</span> <span class="o">*</span> <span class="n">mp_ax</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">g_k_ax</span> <span class="o">=</span> <span class="n">gkbar</span> <span class="o">*</span> <span class="n">s_ax</span>
            <span class="n">g_kf_ax</span> <span class="o">=</span> <span class="n">gkfbar</span> <span class="o">*</span> <span class="n">n_ax</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">g_l_ax</span> <span class="o">=</span> <span class="n">glbar</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">glbar</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
            <span class="n">g_q_ax</span> <span class="o">=</span> <span class="n">gqbar</span> <span class="o">*</span> <span class="n">q_ax</span>

            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">g_na_ax</span><span class="p">,</span> <span class="n">g_nap_ax</span><span class="p">,</span> <span class="n">g_k_ax</span><span class="p">,</span> <span class="n">g_kf_ax</span><span class="p">,</span> <span class="n">g_l_ax</span><span class="p">,</span> <span class="n">g_q_ax</span><span class="p">]</span>            
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="myelinated.get_membrane_conductance"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.get_membrane_conductance">[docs]</a>    <span class="k">def</span> <span class="nf">get_membrane_conductance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the total membrane conductance at the end of simulation. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_ionic_conductance</span><span class="p">())</span></div>

<div class="viewcode-block" id="myelinated.set_Nav_recorders"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.set_Nav_recorders">[docs]</a>    <span class="k">def</span> <span class="nf">set_Nav_recorders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the markov model recording. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Nav1.1 variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I_nav11_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C1_nav11_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2_nav11_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">O1_nav11_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">O2_nav11_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I1_nav11_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I2_nav11_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="c1"># Nav1.6 variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I_nav16_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C1_nav16_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C2_nav16_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">O1_nav16_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">O2_nav16_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I1_nav16_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">I2_nav16_reclist</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">List</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">:</span>
            <span class="c1"># Nav1.1</span>
            <span class="n">I_nav11</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_ina_na11a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">C1_nav11</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_C1_na11a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">C2_nav11</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_C2_na11a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">O1_nav11</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_O1_na11a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">O2_nav11</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_O2_na11a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">I1_nav11</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_I1_na11a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">I2_nav11</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_I2_na11a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_nav11_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I_nav11</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C1_nav11_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C1_nav11</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2_nav11_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C2_nav11</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">O1_nav11_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">O1_nav11</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">O2_nav11_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">O2_nav11</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I1_nav11_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I1_nav11</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I2_nav11_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I2_nav11</span><span class="p">)</span>
            <span class="c1"># Nav1.6</span>
            <span class="n">I_nav16</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_ina_na16a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">C1_nav16</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_C1_na16a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">C2_nav16</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_C2_na16a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">O1_nav16</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_O1_na16a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">O2_nav16</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_O2_na16a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">I1_nav16</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_I1_na16a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">I2_nav16</span> <span class="o">=</span> <span class="n">neuron</span><span class="o">.</span><span class="n">h</span><span class="o">.</span><span class="n">Vector</span><span class="p">()</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">](</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">_ref_I2_na16a</span><span class="p">,</span>\
                <span class="n">sec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I_nav16_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I_nav16</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C1_nav16_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C1_nav16</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C2_nav16_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C2_nav16</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">O1_nav16_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">O1_nav16</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">O2_nav16_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">O2_nav16</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I1_nav16_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I1_nav16</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">I2_nav16_reclist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">I2_nav16</span><span class="p">)</span></div>

<div class="viewcode-block" id="myelinated.get_Nav_values"><a class="viewcode-back" href="../../../nrv.nmod.html#nrv.nmod.myelinated.myelinated.get_Nav_values">[docs]</a>    <span class="k">def</span> <span class="nf">get_Nav_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the markov model at the end of simulation. For internal use only.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Nav1.1 values</span>
        <span class="n">I_nav11_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">C1_nav11_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">C2_nav11_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">O1_nav11_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">O2_nav11_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">I1_nav11_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">I2_nav11_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I_nav11_reclist</span><span class="p">)):</span>
            <span class="n">I_nav11_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I_nav11_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">C1_nav11_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C1_nav11_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">C2_nav11_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2_nav11_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">O1_nav11_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">O1_nav11_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">O2_nav11_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">O2_nav11_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">I1_nav11_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I1_nav11_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">I2_nav11_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I2_nav11_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="c1"># Nav1.6 values</span>
        <span class="n">I_nav16_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">C1_nav16_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">C2_nav16_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">O1_nav16_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">O2_nav16_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">I1_nav16_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="n">I2_nav16_ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Markov_Nav_modeled_NoR</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">t_len</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I_nav11_reclist</span><span class="p">)):</span>
            <span class="n">I_nav16_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I_nav16_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">C1_nav16_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C1_nav16_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">C2_nav16_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C2_nav16_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">O1_nav16_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">O1_nav16_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">O2_nav16_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">O2_nav16_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">I1_nav16_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I1_nav16_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            <span class="n">I2_nav16_ax</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">I2_nav16_reclist</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">I_nav11_ax</span><span class="p">,</span> <span class="n">C1_nav11_ax</span><span class="p">,</span> <span class="n">C2_nav11_ax</span><span class="p">,</span> <span class="n">O1_nav11_ax</span><span class="p">,</span> <span class="n">O2_nav11_ax</span><span class="p">,</span> <span class="n">I1_nav11_ax</span><span class="p">,</span> <span class="n">I2_nav11_ax</span><span class="p">,</span> <span class="n">I_nav16_ax</span><span class="p">,</span> <span class="n">C1_nav16_ax</span><span class="p">,</span> <span class="n">C2_nav16_ax</span><span class="p">,</span> <span class="n">O1_nav16_ax</span><span class="p">,</span> <span class="n">O2_nav16_ax</span><span class="p">,</span> <span class="n">I1_nav16_ax</span><span class="p">,</span> <span class="n">I2_nav16_ax</span></div></div>
</pre></div>
        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            Made with 
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    </body>
</html>